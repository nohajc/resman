version: 1.0.{build}

image: Visual Studio 2017

install:
  - ps: cd rescomp
  - ps: mkdir deps
  - ps: cd deps
  - curl -L https://github.com/nohajc/llvm-clang-static-libs-prebuilt/releases/download/v6.0.1/llvm-clang-6.0-libs-win-x64.7z -o llvm-clang-6.0-libs-win-x64.7z
  - 7z x llvm-clang-6.0-libs-win-x64.7z -aoa
  - ps: cd ..\..

platform: x64
configuration: Release

build:
  project: rescomp/rescomp.vcxproj

after_build:
  - 7z a resman-win-amd64.zip %APPVEYOR_BUILD_FOLDER%\rescomp\x64\Release\rescomp.exe %APPVEYOR_BUILD_FOLDER%\include\resman.h

artifacts:
  - path: "resman-win-amd64.zip"
    name: resman-win-amd64

deploy:
  description: ''
  provider: GitHub
  auth_token:
    secure: 1DCO8YjfqPzSYRgRmllpCPUYHQIKY+hZkIU0YRlVTnukjJTLWXxKwt9Gm2PnnC8x
    artifact: resman-win-amd64
  on:
    branch: master
    appveyor_repo_tag: true
